# Farm Climate Reporter - í”„ë¡œì íŠ¸ êµ¬ì¡° ë¶„ì„

## ğŸ“‹ í”„ë¡œì íŠ¸ ê°œìš”

í•œêµ­ ë†ê°€ë¥¼ ìœ„í•œ **2ì£¼ ê¸°ìƒ í–‰ë™ ë¸Œë¦¬í”„ SMS ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤.
- LLM ê¸°ë°˜ ê°œì¸í™” ë†ì—… ì¡°ì–¸ ìƒì„±
- SMSë¡œ ê°„ë‹¨í•œ ìš”ì•½ ì „ë‹¬ + ìƒì„¸ ì›¹í˜ì´ì§€ ë§í¬ ì œê³µ
- ì–‘ë°©í–¥ í‚¤ì›Œë“œ ì‘ë‹µ (1, REPORT, CHANGE, STOP)

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ì‚¬ìš©ì (ë†ê°€)                              â”‚
â”‚              â†“ SMS ìˆ˜ì‹            â†‘ SMS ë°œì†¡                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    SOLAPI SMS ì„œë¹„ìŠ¤                          â”‚
â”‚              â†“ Webhook           â†‘ API                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               FastAPI ë°±ì—”ë“œ (Port 8080)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  API Routes                                          â”‚   â”‚
â”‚  â”‚  - /api/briefs (POST) â†’ LLM íŒŒì´í”„ë¼ì¸ + SMS ë°œì†¡      â”‚   â”‚
â”‚  â”‚  - /api/briefs/preview (POST) â†’ LLM íŒŒì´í”„ë¼ì¸ë§Œ       â”‚   â”‚
â”‚  â”‚  - /api/sms/webhook (POST) â†’ ì–‘ë°©í–¥ í‚¤ì›Œë“œ ì²˜ë¦¬        â”‚   â”‚
â”‚  â”‚  - /public/briefs/{link_id} (GET) â†’ ìƒì„¸ í˜ì´ì§€       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LLM Services                                        â”‚   â”‚
â”‚  â”‚  - OpenAI (ìƒì„¸ ë³´ê³ ì„œ ìƒì„± + RAG)                     â”‚   â”‚
â”‚  â”‚  - Gemini (ì‰¬ìš´ í•œêµ­ì–´ë¡œ ì •ì œ)                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Storage (Memory or PostgreSQL)                      â”‚   â”‚
â”‚  â”‚  - Profile, Brief, Report, Link ì €ì¥                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         React ìš´ì˜ì ì½˜ì†” (ê°œë°œ: 5173, í”„ë¡œë•ì…˜: /console)    â”‚
â”‚         - ë¸Œë¦¬í”„ ë°œì†¡ í…ŒìŠ¤íŠ¸                                  â”‚
â”‚         - í”„ë¦¬ë·° í™•ì¸                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
farm-climate-reporter/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                      # FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜
â”‚   â”‚   â”œâ”€â”€ app.py               # ë©”ì¸ ì•± + ë¼ìš°í„° ë“±ë¡
â”‚   â”‚   â””â”€â”€ routes/              # API ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚       â”œâ”€â”€ briefs.py        # ë¸Œë¦¬í”„ ìƒì„±/í”„ë¦¬ë·°
â”‚   â”‚       â”œâ”€â”€ public.py        # ê³µê°œ ìƒì„¸ í˜ì´ì§€
â”‚   â”‚       â””â”€â”€ webhook.py       # SMS ì–‘ë°©í–¥ ì²˜ë¦¬
â”‚   â”œâ”€â”€ lib/                     # í•µì‹¬ ëª¨ë¸ & ìœ í‹¸ë¦¬í‹°
â”‚   â”‚   â”œâ”€â”€ models.py           # Pydantic ë°ì´í„° ëª¨ë¸
â”‚   â”‚   â”œâ”€â”€ policy.py           # ì•ˆì „ ì •ì±… ê²€ì¦
â”‚   â”‚   â””â”€â”€ format_ko.py        # í•œêµ­ì–´ í¬ë§·íŒ…
â”‚   â”œâ”€â”€ services/                # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”‚   â”œâ”€â”€ briefs/             # ë¸Œë¦¬í”„ ìƒì„± íŒŒì´í”„ë¼ì¸
â”‚   â”‚   â”‚   â”œâ”€â”€ generator.py   # ì „ì²´ íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
â”‚   â”‚   â”‚   â”œâ”€â”€ retriever.py   # RAG (Vector Store)
â”‚   â”‚   â”‚   â”œâ”€â”€ summarizer.py  # LLM-1 ìƒì„¸ ë³´ê³ ì„œ
â”‚   â”‚   â”‚   â”œâ”€â”€ citations.py   # ì¶œì²˜ ì¶”ê°€
â”‚   â”‚   â”‚   â”œâ”€â”€ sms_builder.py # SMS ë³¸ë¬¸ ìƒì„±
â”‚   â”‚   â”‚   â””â”€â”€ plan_b.py      # ëŒ€ì²´ í–‰ë™ ì œì•ˆ
â”‚   â”‚   â”œâ”€â”€ llm/                # LLM í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”‚   â”œâ”€â”€ factory.py     # LLM íŒ©í† ë¦¬
â”‚   â”‚   â”‚   â”œâ”€â”€ openai_client.py
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_client.py
â”‚   â”‚   â”‚   â””â”€â”€ fakes.py       # ì˜¤í”„ë¼ì¸ ìŠ¤í…
â”‚   â”‚   â”œâ”€â”€ sms/
â”‚   â”‚   â”‚   â””â”€â”€ solapi_client.py # SOLAPI SDK ë˜í¼
â”‚   â”‚   â”œâ”€â”€ links/
â”‚   â”‚   â”‚   â””â”€â”€ link_service.py  # ë§í¬ ìƒì„±/ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ keywords/
â”‚   â”‚   â”‚   â”œâ”€â”€ handler.py       # ì–‘ë°©í–¥ í‚¤ì›Œë“œ ì²˜ë¦¬
â”‚   â”‚   â”‚   â””â”€â”€ change_flow.py   # CHANGE í‚¤ì›Œë“œ íë¦„
â”‚   â”‚   â”œâ”€â”€ signals/
â”‚   â”‚   â”‚   â””â”€â”€ mappings.py      # ì‹œë‚˜ë¦¬ì˜¤ â†’ í–‰ë™ ë§¤í•‘
â”‚   â”‚   â””â”€â”€ store/
â”‚   â”‚       â”œâ”€â”€ memory_store.py  # ì¸ë©”ëª¨ë¦¬ ì €ì¥ì†Œ
â”‚   â”‚       â””â”€â”€ postgres_store.py # PostgreSQL ì €ì¥ì†Œ
â”‚   â””â”€â”€ templates/               # Jinja2 í…œí”Œë¦¿
â”‚       â”œâ”€â”€ detail.html         # ìƒì„¸ í˜ì´ì§€ HTML
â”‚       â””â”€â”€ static/
â”‚           â””â”€â”€ style.css
â”œâ”€â”€ frontend/                    # React ìš´ì˜ì ì½˜ì†”
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ App.tsx             # ë©”ì¸ ì½˜ì†” UI
â”‚   â”‚   â”œâ”€â”€ main.tsx            # React ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ types.ts            # TypeScript íƒ€ì…
â”‚   â”‚   â”œâ”€â”€ phone.ts            # ì „í™”ë²ˆí˜¸ ì •ê·œí™”
â”‚   â”‚   â””â”€â”€ index.css           # ìŠ¤íƒ€ì¼
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.ts          # Vite ì„¤ì • + í”„ë¡ì‹œ
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ alembic/                     # DB ë§ˆì´ê·¸ë ˆì´ì…˜
â”‚   â””â”€â”€ versions/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ demo_smoke.sh           # ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸
â”‚   â””â”€â”€ pipeline_preview.py     # CLI íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_format_ko.py
â”‚   â””â”€â”€ test_pipeline_offline.py
â”œâ”€â”€ specs/                       # í”„ë¡œì íŠ¸ ìŠ¤í™ ë¬¸ì„œ
â”œâ”€â”€ docs/                        # ë¬¸ì„œ
â”œâ”€â”€ requirements.txt             # Python ì˜ì¡´ì„±
â”œâ”€â”€ docker-compose.yml           # Docker êµ¬ì„±
â”œâ”€â”€ Dockerfile                   # ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ
â””â”€â”€ README.md
```

---

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸ ì „ì²´ ë§µ

### 1. **POST `/api/briefs`** - ë¸Œë¦¬í”„ ìƒì„± & SMS ë°œì†¡

**ìš”ì²­:**
```json
{
  "phone": "+821022168618",
  "region": "ìˆ˜ë„ê¶Œ",
  "crop": "ë”¸ê¸°",
  "stage": "ë°œì•„ê¸°",
  "scenario": "í­ì—¼"
}
```

**ì‘ë‹µ:**
```json
{
  "brief_id": "uuid-here",
  "message_preview": "SMS ì²« ì¤„ ë¯¸ë¦¬ë³´ê¸°..."
}
```

**ë™ì‘ íë¦„:**
1. í”„ë¡œí•„ ì €ì¥ (ì „í™”ë²ˆí˜¸, ì§€ì—­, ì‘ë¬¼, ìƒìœ¡ë‹¨ê³„)
2. ì‹œë‚˜ë¦¬ì˜¤ â†’ í–‰ë™(Action) ë§¤í•‘
3. **LLM íŒŒì´í”„ë¼ì¸ ì‹¤í–‰:**
   - RAG: Vector Store ê²€ìƒ‰ (OpenAI file_search)
   - LLM-1: OpenAIë¡œ ìƒì„¸ ë³´ê³ ì„œ ìƒì„±
   - LLM-2: Geminië¡œ ì‰¬ìš´ í•œêµ­ì–´ë¡œ ì •ì œ
4. ë§í¬ ìƒì„± (`/public/briefs/{link_id}`)
5. SMS ë³¸ë¬¸ ì‘ì„± (ì •ì œëœ ë³´ê³ ì„œ + ë§í¬)
6. SOLAPIë¡œ SMS ë°œì†¡
7. ë°ì´í„° ì €ì¥

---

### 2. **POST `/api/briefs/preview`** - íŒŒì´í”„ë¼ì¸ë§Œ ì‹¤í–‰ (SMS ë°œì†¡ X)

**ìš”ì²­:**
```json
{
  "region": "ìˆ˜ë„ê¶Œ",
  "crop": "ë”¸ê¸°",
  "stage": "ë°œì•„ê¸°",
  "scenario": "í­ì—¼"
}
```

**ì‘ë‹µ:**
```json
{
  "detailed_report": "OpenAIê°€ ìƒì„±í•œ ìƒì„¸ ë³´ê³ ì„œ...",
  "refined_report": "Geminiê°€ ì •ì œí•œ í•œêµ­ì–´ ë³´ê³ ì„œ...",
  "sms_body": "ì‹¤ì œ SMSë¡œ ì „ì†¡ë  ë³¸ë¬¸..."
}
```

**ì‚¬ìš© ì‚¬ë¡€:**
- í…ŒìŠ¤íŠ¸/ê°œë°œ ì‹œ SMS ë°œì†¡ ì—†ì´ LLM ê²°ê³¼ë§Œ í™•ì¸
- ìš´ì˜ì ì½˜ì†”ì—ì„œ í”„ë¦¬ë·° ë²„íŠ¼

---

### 3. **POST `/api/sms/webhook`** - SMS ì–‘ë°©í–¥ í‚¤ì›Œë“œ ì²˜ë¦¬

**ìš”ì²­ (SOLAPIì—ì„œ ì „ë‹¬):**
```json
{
  "from": "+821022168618",
  "to": "+821087654321",
  "message": "REPORT",
  "timestamp": "2025-10-30T12:00:00Z"
}
```

**ì‘ë‹µ:**
```json
{
  "status": "ok"
}
```

**ì§€ì› í‚¤ì›Œë“œ:**
- `1` â†’ ìµœê·¼ ë¸Œë¦¬í”„ì˜ ìƒì„¸ ë§í¬ ì „ì†¡
- `REPORT` â†’ ìµœê·¼ ë¸Œë¦¬í”„ ìš”ì•½ ì „ì†¡
- `CHANGE` â†’ í”„ë¡œí•„ ë³€ê²½ ê°€ì´ë“œ ì „ì†¡
- `STOP` â†’ ìˆ˜ì‹  ì¤‘ì§€

---

### 4. **GET `/public/briefs/{link_id}`** - ìƒì„¸ í˜ì´ì§€ (HTML)

**URL ì˜ˆì‹œ:**
```
https://your-server.com/public/briefs/abc123def456
```

**ë Œë”ë§ ë‚´ìš©:**
- 3ì¤„ ìš”ì•½ (ì œëª©, ì²« ë¬¸ì¥, ë‚ ì§œ)
- ì²´í¬ë¦¬ìŠ¤íŠ¸ (Top-3 í–‰ë™)
- Plan B (ëŒ€ì²´ í–‰ë™)
- ì¶œì²˜/ì—°ë„ ëª©ë¡
- ìƒì„¸ ë³´ê³ ì„œ ì „ë¬¸

**í…œí”Œë¦¿:**
- `src/templates/detail.html` (Jinja2)
- CSS: `src/templates/static/style.css`

---

### 5. **GET `/health`** - Health Check

**ì‘ë‹µ:**
```json
{
  "status": "ok"
}
```

---

## ğŸ¯ ë°ì´í„° ëª¨ë¸ (`src/lib/models.py`)

### **Profile** - ì‚¬ìš©ì í”„ë¡œí•„
```python
{
  "id": "ì „í™”ë²ˆí˜¸",
  "phone": "+821022168618",
  "region": "ìˆ˜ë„ê¶Œ",
  "crop": "ë”¸ê¸°",
  "stage": "ë°œì•„ê¸°",
  "language": "ko",
  "opt_in": true
}
```

### **Action** - ì¶”ì²œ í–‰ë™
```python
{
  "title": "ë©€ì¹­ ë‘ê»˜ ì¡°ì ˆ",
  "timing_window": "ì´ë²ˆ ì£¼ í™”~ëª©",
  "trigger": "ìµœê³ ê¸°ì˜¨ 32ë„ ì˜ˆìƒ",
  "icon": "ğŸŒ¡ï¸",
  "source_name": "ë†ì´Œì§„í¥ì²­",
  "source_year": 2023
}
```

### **Brief** - ë¸Œë¦¬í”„ ë©”íƒ€ë°ì´í„°
```python
{
  "id": "uuid",
  "profile_id": "+821022168618",
  "horizon_days": 14,
  "actions": [Action, Action, Action],
  "triggers": ["HEATWAVE"],
  "link_id": "abc123",
  "date_range": "2025-10-30 ~ 2025-11-13",
  "created_at": "2025-10-30T12:00:00Z"
}
```

### **DraftReport** - LLM-1 ìƒì„± ë³´ê³ ì„œ
```python
{
  "id": "uuid",
  "brief_id": "brief-uuid",
  "content": "OpenAIê°€ ìƒì„±í•œ ìƒì„¸ ë³´ê³ ì„œ...",
  "created_at": "2025-10-30T12:00:00Z"
}
```

### **RefinedReport** - LLM-2 ì •ì œ ë³´ê³ ì„œ
```python
{
  "id": "uuid",
  "draft_id": "draft-uuid",
  "content": "Geminiê°€ ì •ì œí•œ í•œêµ­ì–´ ë³´ê³ ì„œ...",
  "created_at": "2025-10-30T12:00:00Z"
}
```

---

## ğŸ”„ LLM íŒŒì´í”„ë¼ì¸ í”Œë¡œìš°

```
ì…ë ¥: Profile + Scenario
   â†“
[1] Scenario â†’ Actions ë§¤í•‘ (signals/mappings.py)
   â†“
[2] RAG ê²€ìƒ‰ (briefs/retriever.py)
   - OpenAI Vector Store file_search
   â†“
[3] LLM-1: OpenAI (briefs/summarizer.py)
   - í”„ë¡¬í”„íŠ¸: "ì§€ì—­/ì‘ë¬¼/ìƒìœ¡ë‹¨ê³„ ê¸°ë°˜ ìƒì„¸ ë³´ê³ ì„œ ìƒì„±"
   - ì¶œë ¥: ìƒì„¸ ë³´ê³ ì„œ (ì „ë¬¸ì /ê¸¸ì´)
   â†“
[4] LLM-2: Gemini (briefs/generator.py)
   - í”„ë¡¬í”„íŠ¸: "ê³ ë ¹ ë†ê°€ ì´í•´ ì‰¬ìš´ í•œêµ­ì–´ë¡œ ì •ì œ"
   - ì¶œë ¥: ì •ì œëœ ë³´ê³ ì„œ (ê°„ê²°/ì‰¬ìš´ ì–´íœ˜)
   â†“
[5] ì¶œì²˜ ì¶”ê°€ (briefs/citations.py)
   - ê° í–‰ë™ì— (ì¶œì²˜ëª…, ì—°ë„) ì¶”ê°€
   â†“
[6] SMS ë³¸ë¬¸ ì‘ì„± (briefs/sms_builder.py)
   - ì •ì œ ë³´ê³ ì„œ + ë§í¬
   â†“
[7] SOLAPI ë°œì†¡ (sms/solapi_client.py)
   â†“
ê²°ê³¼: Brief + Reports ì €ì¥
```

---

## âš›ï¸ React í”„ë¡ íŠ¸ì—”ë“œ êµ¬ì¡°

### **íŒŒì¼ êµ¬ì„±**
```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ App.tsx          # ë©”ì¸ UI ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ main.tsx         # React ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ types.ts         # API íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ phone.ts         # ì „í™”ë²ˆí˜¸ ì •ê·œí™” ìœ í‹¸
â”‚   â””â”€â”€ index.css        # ì „ì—­ ìŠ¤íƒ€ì¼
â”œâ”€â”€ vite.config.ts       # Vite ì„¤ì • + í”„ë¡ì‹œ
â””â”€â”€ package.json
```

### **ë¼ìš°íŒ…**
ReactëŠ” **SPA (Single Page Application)**ë¡œ ë¼ìš°íŒ…ì´ ì—†ìŠµë‹ˆë‹¤.
- ë‹¨ì¼ í˜ì´ì§€: ìš´ì˜ì ì½˜ì†” UI
- ëª¨ë“  ìƒíƒœëŠ” ë¡œì»¬ ì»´í¬ë„ŒíŠ¸ stateë¡œ ê´€ë¦¬

### **Vite Proxy ì„¤ì • (`vite.config.ts`)**

ê°œë°œ í™˜ê²½ì—ì„œ CORS ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í”„ë¡ì‹œ ì‚¬ìš©:

```typescript
server: {
  port: 5173,
  proxy: {
    '/api': {
      target: 'http://127.0.0.1:8000',  // FastAPI ì„œë²„
      changeOrigin: true
    },
    '/health': {
      target: 'http://127.0.0.1:8000',
      changeOrigin: true
    }
  }
}
```

**ë™ì‘:**
- ë¸Œë¼ìš°ì €: `http://localhost:5173/api/briefs` ìš”ì²­
- Vite: `http://127.0.0.1:8000/api/briefs`ë¡œ í”„ë¡ì‹œ
- CORS ì—ëŸ¬ ì—†ìŒ!

### **ì£¼ìš” ê¸°ëŠ¥ (App.tsx)**

1. **í¼ ì…ë ¥**
   - ì „í™”ë²ˆí˜¸ (E.164 í˜•ì‹ ìë™ ë³€í™˜)
   - ì§€ì—­ (ìˆ˜ë„ê¶Œ, ê°•ì›, ì¶©ì²­, í˜¸ë‚¨, ì˜ë‚¨, ì œì£¼)
   - ì‘ë¬¼, ìƒìœ¡ë‹¨ê³„, ì‹œë‚˜ë¦¬ì˜¤

2. **í”„ë¦¬ë·° ìš”ì²­**
   - `/api/briefs/preview` í˜¸ì¶œ
   - LLM íŒŒì´í”„ë¼ì¸ ê²°ê³¼ í™•ì¸ (SMS ë°œì†¡ X)

3. **SMS ë°œì†¡**
   - `/api/briefs` í˜¸ì¶œ
   - ì‹¤ì œ SMS ë°œì†¡ (SOLAPI_DRY_RUN=1ì´ë©´ ë°œì†¡ X)

4. **Health Check**
   - 15ì´ˆë§ˆë‹¤ `/health` í˜¸ì¶œ
   - API ìƒíƒœ í‘œì‹œ

5. **LocalStorage ì €ì¥**
   - í¼ ì…ë ¥ê°’ ìë™ ì €ì¥/ë³µì›

---

## ğŸ—„ï¸ ì €ì¥ì†Œ (Store)

### **Memory Store** (ê¸°ë³¸)
- `src/services/store/memory_store.py`
- ì¸ë©”ëª¨ë¦¬ ë”•ì…”ë„ˆë¦¬ ì €ì¥
- ì„œë²„ ì¬ì‹œì‘ ì‹œ ë°ì´í„° ì†ì‹¤
- ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©

### **PostgreSQL Store** (í”„ë¡œë•ì…˜)
- `src/services/store/postgres_store.py`
- í™˜ê²½ë³€ìˆ˜: `STORE_BACKEND=postgres`, `DATABASE_URL=...`
- Alembic ë§ˆì´ê·¸ë ˆì´ì…˜ ì‚¬ìš©
- Docker Composeì— ê¸°ë³¸ í¬í•¨

---

## ğŸ” í™˜ê²½ë³€ìˆ˜

```bash
# LLM API í‚¤
OPENAI_API_KEY=sk-...
GEMINI_API_KEY=...
OPENAI_VECTOR_STORE_ID=vs_...

# SMS
SOLAPI_ACCESS_KEY=...
SOLAPI_SECRET_KEY=...
SOLAPI_SENDER_NUMBER=01012345678
SOLAPI_DRY_RUN=1  # 1ì´ë©´ ë°œì†¡ ì•ˆí•¨

# ë°ëª¨
DEMO_RECIPIENT_NUMBER=+821022168618

# ë§í¬ ë² ì´ìŠ¤ URL
DETAIL_BASE_URL=https://parut.com/public/briefs

# ì €ì¥ì†Œ
STORE_BACKEND=postgres  # ë˜ëŠ” memory
DATABASE_URL=postgresql+psycopg2://user:pass@db:5432/farm_db

# ì˜¤í”„ë¼ì¸ ëª¨ë“œ
LLM_OFFLINE=1  # 1ì´ë©´ ìŠ¤í… LLM ì‚¬ìš©
```

---

## ğŸš€ ê°œë°œ í™˜ê²½ ì‹¤í–‰

### **ë°±ì—”ë“œë§Œ**
```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt

# .env ì„¤ì •
cp .env.sample .env
nano .env

# ì„œë²„ ì‹¤í–‰
uvicorn src.api.app:app --reload
```

ì ‘ì†: `http://localhost:8000`

### **í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì„œë²„**
```bash
cd frontend
npm install
npm run dev
```

ì ‘ì†: `http://localhost:5173`
- API í˜¸ì¶œì€ ìë™ìœ¼ë¡œ `localhost:8000`ìœ¼ë¡œ í”„ë¡ì‹œë¨

### **Docker Compose (í†µí•©)**
```bash
docker-compose build
docker-compose up -d
```

ì ‘ì†: `http://localhost:8080`

---

## ğŸ¨ í”„ë¡œë•ì…˜ ë¹Œë“œ

### **React ë¹Œë“œ**
```bash
cd frontend
npm run build
# ê²°ê³¼: frontend/dist/
```

### **FastAPIê°€ ìë™ ì„œë¹™**
- `frontend/dist` ì¡´ì¬ ì‹œ
- `/` â†’ React ì•±
- `/api/*` â†’ API ì—”ë“œí¬ì¸íŠ¸
- `/public/briefs/{link_id}` â†’ ìƒì„¸ í˜ì´ì§€ (Jinja2)

### **Docker ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ**
```dockerfile
# Stage 1: React ë¹Œë“œ
FROM node:18-alpine AS frontend-builder
WORKDIR /frontend
COPY frontend/package*.json ./
RUN npm ci
COPY frontend/ ./
RUN npm run build

# Stage 2: Python ë°±ì—”ë“œ
FROM python:3.11-slim AS base
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
COPY --from=frontend-builder /frontend/dist /app/frontend/dist
CMD ["uvicorn", "src.api.app:app", "--host", "0.0.0.0", "--port", "8080"]
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸

### **ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸**
```bash
./scripts/demo_smoke.sh
```

### **íŒŒì´í”„ë¼ì¸ í”„ë¦¬ë·° (CLI)**
```bash
python scripts/pipeline_preview.py \
  --region ìˆ˜ë„ê¶Œ \
  --crop ë”¸ê¸° \
  --stage ë°œì•„ê¸° \
  --scenario í­ì—¼ \
  --offline \
  --log logs/pipeline.log
```

### **pytest**
```bash
pytest tests/
```

---

## ğŸ“Š ìš”ì•½ ë‹¤ì´ì–´ê·¸ë¨

### **ìš”ì²­ íë¦„**

```
ì‚¬ìš©ì â†’ SOLAPI â†’ Webhook â†’ FastAPI â†’ í‚¤ì›Œë“œ ì²˜ë¦¬ â†’ SOLAPI â†’ ì‚¬ìš©ì
                                  â†“
                             Store (Memory/Postgres)
```

```
ìš´ì˜ì ì½˜ì†” â†’ FastAPI /api/briefs â†’ LLM Pipeline â†’ SOLAPI â†’ SMS ë°œì†¡
                                          â†“
                                    Store + Link ìƒì„±
```

```
ì‚¬ìš©ì â†’ ë¸Œë¼ìš°ì € â†’ /public/briefs/{link_id} â†’ Jinja2 í…œí”Œë¦¿ â†’ HTML í˜ì´ì§€
```

---

## ğŸ”‘ í•µì‹¬ íŒŒì¼ ì²´í¬ë¦¬ìŠ¤íŠ¸

| íŒŒì¼ | ì—­í•  |
|------|------|
| `src/api/app.py` | FastAPI ì•± + ë¼ìš°í„° ë“±ë¡ |
| `src/api/routes/briefs.py` | ë¸Œë¦¬í”„ ìƒì„±/í”„ë¦¬ë·° API |
| `src/api/routes/public.py` | ìƒì„¸ í˜ì´ì§€ ë Œë”ë§ |
| `src/api/routes/webhook.py` | SMS ì–‘ë°©í–¥ ì²˜ë¦¬ |
| `src/services/briefs/generator.py` | LLM íŒŒì´í”„ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ |
| `src/services/llm/openai_client.py` | OpenAI API í´ë¼ì´ì–¸íŠ¸ |
| `src/services/llm/gemini_client.py` | Gemini API í´ë¼ì´ì–¸íŠ¸ |
| `src/services/sms/solapi_client.py` | SOLAPI SDK ë˜í¼ |
| `frontend/src/App.tsx` | React ìš´ì˜ì ì½˜ì†” UI |
| `frontend/vite.config.ts` | Vite ì„¤ì • + í”„ë¡ì‹œ |
| `Dockerfile` | ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ |
| `docker-compose.yml` | í†µí•© ë°°í¬ êµ¬ì„± |

---

## ğŸ’¡ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

### Q: APIì™€ í”„ë¡ íŠ¸ì—”ë“œê°€ ì–´ë–»ê²Œ í†µì‹ í•˜ë‚˜ìš”?
A: 
- **ê°œë°œ**: Vite í”„ë¡ì‹œ (`localhost:5173/api` â†’ `localhost:8000/api`)
- **í”„ë¡œë•ì…˜**: ê°™ì€ ì„œë²„ (`localhost:8080/api`)

### Q: Reactì— ë¼ìš°íŒ…ì´ ìˆë‚˜ìš”?
A: ì—†ìŠµë‹ˆë‹¤. ë‹¨ì¼ í˜ì´ì§€ ì½˜ì†”ì…ë‹ˆë‹¤. í˜ì´ì§€ ì „í™˜ì´ í•„ìš”í•˜ë©´ `react-router-dom` ì¶”ê°€ í•„ìš”.

### Q: ìƒì„¸ í˜ì´ì§€ëŠ” ì–´ë–»ê²Œ ì„œë¹™ë˜ë‚˜ìš”?
A: FastAPIê°€ Jinja2 í…œí”Œë¦¿ìœ¼ë¡œ HTMLì„ ì„œë²„ì‚¬ì´ë“œ ë Œë”ë§í•©ë‹ˆë‹¤.

### Q: SMS ë°œì†¡ì„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´?
A: `.env`ì— `SOLAPI_DRY_RUN=1` ì„¤ì • â†’ ë¡œê·¸ë§Œ ì¶œë ¥, ì‹¤ì œ ë°œì†¡ X

### Q: LLM ì—†ì´ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´?
A: `LLM_OFFLINE=1` ì„¤ì • â†’ ìŠ¤í… LLM ì‚¬ìš© (fake ì‘ë‹µ)

---

ì´ ë¬¸ì„œë¡œ í”„ë¡œì íŠ¸ ì „ì²´ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸ‰
